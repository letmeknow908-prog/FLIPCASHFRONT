<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FlipCash - Currency Exchange Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #F9FAFB; overflow-x: hidden; }
        .header { background: white; padding: 15px 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: fixed; top: 0; left: 0; right: 0; z-index: 9999; display: flex; justify-content: space-between; align-items: center; height: 60px; }
        .logo { font-size: 24px; font-weight: bold; color: #10B981; cursor: pointer; }
        .nav-btns { display: flex; gap: 10px; align-items: center; }
        .btn { padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px; text-decoration: none; display: inline-block; border: none; transition: all 0.3s; }
        .btn:active { transform: scale(0.95); }
        .btn-login { border: 2px solid #10B981; background: transparent; color: #10B981; }
        .btn-register { background: #10B981; color: white; }
        .btn-logout { background: #EF4444; color: white; }
        .btn-primary { background: #10B981; color: white; width: 100%; padding: 15px; font-size: 16px; margin-top: 10px; }
        .btn-primary:disabled { background: #9CA3AF; cursor: not-allowed; opacity: 0.6; }
        .notif-bell { position: relative; cursor: pointer; font-size: 24px; color: #6B7280; margin-right: 10px; }
        .notif-badge { position: absolute; top: -5px; right: -5px; background: #EF4444; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 11px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .notif-panel { position: fixed; top: 60px; right: 0; width: 100%; max-width: 400px; max-height: 80vh; background: white; box-shadow: -2px 0 10px rgba(0,0,0,0.1); transform: translateX(100%); transition: transform 0.3s; z-index: 9998; overflow-y: auto; }
        .notif-panel.open { transform: translateX(0); }
        .notif-header { padding: 20px; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center; }
        .notif-item { padding: 15px 20px; border-bottom: 1px solid #E5E7EB; cursor: pointer; }
        .notif-item:hover { background: #F9FAFB; }
        .notif-item.unread { background: #F0FDF4; }
        .page { padding-top: 80px; min-height: calc(100vh - 60px); padding-bottom: 40px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .hidden { display: none !important; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #374151; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 16px; background: white; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #10B981; }
        .password-toggle { position: relative; }
        .password-toggle input { padding-right: 45px; }
        .password-toggle-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 20px; color: #6B7280; }
        .phone-input-group { display: flex; gap: 10px; }
        .phone-input-group select { flex: 0 0 130px; }
        .phone-input-group input { flex: 1; }
        .wallets { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .wallet-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .wallet-card h3 { color: #6B7280; font-size: 14px; text-transform: uppercase; margin-bottom: 10px; }
        .wallet-card .balance { font-size: 2.5rem; font-weight: bold; color: #10B981; }
        .rates { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .action-btn { background: #10B981; color: white; padding: 20px 10px; border-radius: 12px; text-align: center; font-size: 1rem; font-weight: bold; cursor: pointer; border: none; display: block; transition: all 0.3s; }
        .action-btn:hover { background: #059669; transform: translateY(-2px); }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; animation: slideIn 0.3s; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .alert-error { background: #FEE2E2; color: #DC2626; }
        .alert-success { background: #D1FAE5; color: #059669; }
        .alert-info { background: #DBEAFE; color: #1D4ED8; }
        .kyc-step { background: white; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .kyc-status { padding: 10px 20px; border-radius: 8px; display: inline-block; font-weight: 600; margin: 10px 0; }
        .kyc-status.approved { background: #D1FAE5; color: #059669; }
        .kyc-status.pending { background: #FEF3C7; color: #D97706; }
        .kyc-status.rejected { background: #FEE2E2; color: #DC2626; }
        .summary-box { background: linear-gradient(135deg, #10B981, #059669); color: white; padding: 20px; border-radius: 12px; margin: 20px 0; }
        .summary-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.2); }
        .summary-row:last-child { border-bottom: none; font-size: 1.2rem; font-weight: bold; }
        .mpesa-name { background: #F0FDF4; padding: 15px; border-radius: 8px; margin-top: 10px; border: 2px solid #10B981; }
        .hero { background: linear-gradient(135deg, #10B981, #059669); color: white; padding: 100px 20px 60px; text-align: center; min-height: 90vh; display: flex; flex-direction: column; justify-content: center; }
        .hero h1 { font-size: 2.5rem; margin-bottom: 20px; line-height: 1.2; }
        .hero p { font-size: 1.2rem; margin-bottom: 40px; }
        .app-btns { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 20px; }
        .app-btn { display: flex; align-items: center; gap: 15px; background: white; color: #1F2937; padding: 15px 30px; border-radius: 12px; text-decoration: none; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .app-icon { font-size: 40px; }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .toast { position: fixed; bottom: 20px; right: 20px; background: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 10px; z-index: 10000; animation: slideUp 0.3s; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .toast-success { border-left: 4px solid #10B981; }
        .toast-error { border-left: 4px solid #EF4444; }
        .password-strength { height: 4px; background: #E5E7EB; border-radius: 2px; margin-top: 5px; }
        .password-strength-bar { height: 100%; transition: all 0.3s; }
        .checkbox-group { display: flex; align-items: center; gap: 10px; margin: 15px 0; }
        .blur-text { filter: blur(4px); user-select: none; }
        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 9997; opacity: 0; visibility: hidden; }
        .overlay.active { opacity: 1; visibility: visible; }
        @media (max-width: 768px) { .logo { font-size: 20px; } .wallet-card .balance { font-size: 2rem; } .hero h1 { font-size: 1.8rem; } .actions { grid-template-columns: 1fr 1fr; } input, select, textarea { font-size: 16px !important; } }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeNotifications()"></div>
<div class="notif-panel" id="notif-panel"><div class="notif-header"><h3>Notifications</h3><span onclick="closeNotifications()" style="cursor:pointer;font-size:24px">‚úï</span></div><div id="notif-list"></div></div>

<div id="landing-page"><header class="header"><div class="logo" onclick="showPage('landing')">üí∞ FlipCash</div><div class="nav-btns"><a href="#" class="btn btn-login" onclick="event.preventDefault();showPage('login')">Login</a><a href="#" class="btn btn-register" onclick="event.preventDefault();showPage('register')">Get Started</a></div></header><div class="hero"><h1>Exchange Currency Between Nigeria & Kenya Instantly</h1><p>Fast, secure, and reliable currency conversion with live exchange rates</p><div class="app-btns"><a href="https://apps.apple.com" class="app-btn"><span class="app-icon">üçé</span><div><small style="color:#6B7280">Download on the</small><br><strong>App Store</strong></div></a><a href="https://play.google.com" class="app-btn"><span class="app-icon">üì±</span><div><small style="color:#6B7280">Get it on</small><br><strong>Google Play</strong></div></a></div></div></div>

<div id="login-page" class="hidden page"><header class="header"><div class="logo">üí∞ FlipCash</div><div class="nav-btns"><a href="#" class="btn btn-login" onclick="event.preventDefault();showPage('landing')">‚Üê Back</a></div></header><div class="container" style="max-width:400px"><h2 style="text-align:center;margin-bottom:30px">Login</h2><div id="login-alert"></div><div class="form-group"><label>Email</label><input type="email" id="login-email" placeholder="Enter email"></div><div class="form-group"><label>Password</label><div class="password-toggle"><input type="password" id="login-password" placeholder="Enter password"><button type="button" class="password-toggle-btn" onclick="togglePassword('login-password',this)">üëÅÔ∏è</button></div></div><div class="checkbox-group"><input type="checkbox" id="remember-me"><label for="remember-me" style="margin:0;font-weight:normal">Remember me</label></div><button class="btn btn-primary" onclick="handleLogin()" id="login-btn">Login</button><p style="text-align:center;margin-top:15px"><a href="#" onclick="event.preventDefault();showPage('forgot-password')" style="color:#10B981;font-weight:bold">Forgot Password?</a></p><p style="text-align:center;margin-top:10px">Don't have an account? <a href="#" onclick="event.preventDefault();showPage('register')" style="color:#10B981;font-weight:bold">Register</a></p></div></div>

<div id="forgot-password-page" class="hidden page"><header class="header"><div class="logo">üí∞ FlipCash</div><div class="nav-btns"><a href="#" class="btn btn-login" onclick="event.preventDefault();showPage('login')">‚Üê Login</a></div></header><div class="container" style="max-width:400px"><h2 style="text-align:center;margin-bottom:30px">Reset Password</h2><div id="forgot-alert"></div><div class="form-group"><label>Email</label><input type="email" id="forgot-email" placeholder="Enter email"></div><button class="btn btn-primary" onclick="handleForgotPassword()" id="forgot-btn">Send Reset Link</button></div></div>

<div id="register-page" class="hidden page"><header class="header"><div class="logo">üí∞ FlipCash</div><div class="nav-btns"><a href="#" class="btn btn-login" onclick="event.preventDefault();showPage('landing')">‚Üê Back</a></div></header><div class="container" style="max-width:450px"><h2 style="text-align:center;margin-bottom:30px">Create Account</h2><div id="register-alert"></div><div class="form-group"><label>First Name</label><input type="text" id="reg-firstname" placeholder="First name"></div><div class="form-group"><label>Last Name</label><input type="text" id="reg-lastname" placeholder="Last name"></div><div class="form-group"><label>Email</label><input type="email" id="reg-email" placeholder="Email"></div><div class="form-group"><label>Phone</label><div class="phone-input-group"><select id="reg-country-code"><option value="+234">üá≥üá¨ +234</option><option value="+254">üá∞üá™ +254</option></select><input type="tel" id="reg-phone" placeholder="7XXXXXXXX"></div><small style="color:#6B7280;display:block;margin-top:5px">9 digits for Kenya, 10 for Nigeria</small></div><div class="form-group"><label>Password <small style="color:#6B7280">(Min 8, 1 upper, 1 number, 1 special)</small></label><div class="password-toggle"><input type="password" id="reg-password" placeholder="Password" oninput="checkPasswordStrength(this.value)"><button type="button" class="password-toggle-btn" onclick="togglePassword('reg-password',this)">üëÅÔ∏è</button></div><div class="password-strength"><div class="password-strength-bar" id="password-strength-bar"></div></div><div id="password-strength-text" style="font-size:12px;margin-top:5px;font-weight:600"></div></div><div class="form-group"><label>Confirm Password</label><div class="password-toggle"><input type="password" id="reg-password-confirm" placeholder="Confirm"><button type="button" class="password-toggle-btn" onclick="togglePassword('reg-password-confirm',this)">üëÅÔ∏è</button></div></div><button class="btn btn-primary" onclick="handleRegister()" id="register-btn">Create Account</button><p style="text-align:center;margin-top:20px">Have account? <a href="#" onclick="event.preventDefault();showPage('login')" style="color:#10B981;font-weight:bold">Login</a></p></div></div>

<div id="dashboard-page" class="hidden page"><header class="header"><div class="logo">üí∞ FlipCash</div><div class="nav-btns"><div class="notif-bell" onclick="toggleNotifications()">üîî<span class="notif-badge" id="notif-badge" style="display:none">0</span></div><button class="btn btn-logout" onclick="handleLogout()">Logout</button></div></header><div class="container"><h1 style="color:#1F2937;margin-bottom:20px">Dashboard</h1><div class="alert alert-info" id="kyc-alert" style="display:none"><strong>‚ö†Ô∏è KYC Required</strong> <a href="#" onclick="event.preventDefault();showPage('kyc')" style="color:#1D4ED8;font-weight:bold">Verify Now</a></div><div class="wallets"><div class="wallet-card"><h3>NGN</h3><div class="balance" id="ngn-balance">0.00</div></div><div class="wallet-card"><h3>KSH</h3><div class="balance" id="ksh-balance">0.00</div></div></div><div class="rates"><h3>Live Rates üìà</h3><p>1 NGN = <span id="ngn-to-ksh-rate">...</span> KSH</p><p>1 KSH = <span id="ksh-to-ngn-rate">...</span> NGN</p><small style="color:#9CA3AF">Updates every 30s</small></div><div class="actions"><button class="action-btn" onclick="showPage('deposit')">üí≥ Deposit</button><button class="action-btn" onclick="showPage('swap')">üí± Swap</button><button class="action-btn" onclick="showPage('withdraw')">üí∏ Withdraw</button><button class="action-btn" onclick="showPage('history')">üìä History</button><button class="action-btn" onclick="showPage('settings')">‚öôÔ∏è Settings</button><button class="action-btn" onclick="showPage('kyc')">‚úÖ KYC</button></div></div></div>

<div id="deposit-page" class="hidden page"><header class="header"><div class="logo">üí∞ FlipCash</div><div class="nav-btns"><button class="btn btn-login" onclick="showPage('dashboard')">‚Üê Dashboard</button></div></header><div class="container" style="max-width:600px"><h2 style="color:#1F2937;margin-bottom:20px">Deposit</h2><div class="alert alert-info"><strong>‚ÑπÔ∏è</strong> Generate account, transfer from any Nigerian bank. Funds in 5-10 mins.</div><div style="background:white;padding:25px;border-radius:12px;margin:20px 0;box-shadow:0 2px 8px rgba(0,0,0,0.1)"><h3 style="color:#1F2937;margin-bottom:15px">Virtual Account</h3><p style="margin:10px 0;color:#6B7280"><strong>Bank:</strong> Wema Bank</p><p style="margin:10px 0;color:#6B7280"><strong>Name:</strong> <span id="account-name">Click generate</span></p><p style="margin:10px 0;color:#6B7280"><strong>Number:</strong> <strong id="account-number" style="font-size:1.5rem;color:#10B981">---------</strong></p><button class="btn btn-primary" onclick="generateAccount()" id="gen-account-btn"><span id="gen-btn-text">Generate</span><span id="gen-btn-loading" class="loading" style="display:none"></span></button></div></div></div>

<div id="swap-page" class="hidden page"><header class="header"><div class="logo">üí∞ FlipCash</div><div class="nav-btns"><button class="btn btn-login" onclick="showPage('dashboard')">‚Üê Dashboard</button></div></header><div class="container" style="max-width:500px"><h2 style="color:#1F2937;margin-bottom:20px">Swap</h2><div id="swap-alert"></div><div class="form-group"><label>From</label><select id="swap-from" onchange="calculateSwap()"><option value="NGN">NGN</option><option value="KSH">KSH</option></select></div><div class="form-group"><label>To</label><select id="swap-to" onchange="calculateSwap()"><option value="KSH">KSH</option><option value="NGN">NGN</option></select></div><div class="form-group"><label>Amount</label><input type="number" id="swap-amount" placeholder="Amount" step="0.01" oninput="calculateSwap()"><small style="color:#6B7280;margin-top:5px;display:block">Available: <span id="swap-available">0.00</span> <span id="swap-from-curr">NGN</span></small></div><div class="summary-box" id="swap-summary" style="display:none"><h3>üí± Summary</h3><div class="summary-row"><span>Send:</span><strong id="summary-send-amount">0</strong></div><div class="summary-row"><span>Rate:</span><strong id="summary-rate">0</strong></div><div class="summary-row"><span>Fee (1%):</span><strong id="summary-fee">0</strong></div><div class="summary-row"><span>Receive:</span><strong id="summary-receive-amount">0</strong></div></div><button class="btn btn-primary" onclick="handleSwap()" id="swap-btn">Confirm</button></div></div>

<div id="withdraw-page" class="hidden page"><header class="header"><div class="logo">üí∞ FlipCash</div><div class="nav-btns"><button class="btn btn-login" onclick="showPage('dashboard')">‚Üê Dashboard</button></div></header><div class="container" style="max-width:500px"><h2 style="color:#1F2937;margin-bottom:20px">Withdraw</h2><div id="withdraw-alert"></div><div class="alert alert-info"><strong>‚ÑπÔ∏è</strong> KSH only to M-Pesa/Airtel</div><div class="form-group"><label>Amount (KSH)</label><input type="number" id="withdraw-amount" placeholder="Amount" step="0.01" oninput="calculateWithdraw()"><small style="color:#6B7280;margin-top:5px;display:block">Available: <span id="withdraw-available">0.00</span> KSH</small></div><div class="form-group"><label>Phone (+254XXXXXXXXX)</label><input type="tel" id="withdraw-phone" placeholder="+254712345678" oninput="verifyMpesaNumber()"><small style="color:#6B7280;margin-top:5px;display:block">9 digits after +254</small></div><div id="mpesa-name-display" style="display:none"></div><div class="form-group"><label>Method</label><select id="withdraw-method"><option value="MPESA">M-Pesa</option><option value="AIRTEL">Airtel</option></select></div><div class="summary-box" id="withdraw-summary" style="display:none"><h3>üí∏ Summary</h3><div class="summary-row"><span>Amount:</span><strong id="w-summary-amount">0</strong></div><div class="summary-row"><span>Fee (2%):</span><strong id="w-summary-fee">0</strong></div><div class="summary-row"><span>Deducted:</span><strong id="w-summary-total">0</strong></div><div class="summary-row"><span>Receive:</span><strong id="w-summary-receive">0</strong></div></div><button class="btn btn-primary" onclick="handleWithdraw()" id="withdraw-btn">Withdraw</button></div></div>

<div id="history-page" class="hidden page"><header class="header"><div class="logo">üí∞ FlipCash</div><div class="nav-btns"><button class="btn btn-login" onclick="showPage('dashboard')">‚Üê Dashboard</button></div></header><div class="container"><h2 style="color:#1F2937;margin-bottom:20px">History</h2><div style="background:white;border-radius:12px;padding:20px" id="transaction-list"></div></div></div>

<div id="kyc-page" class="hidden page"><header class="header"><div class="logo">üí∞ FlipCash</div><div class="nav-btns"><button class="btn btn-login" onclick="showPage('dashboard')">‚Üê Dashboard</button></div></header><div class="container" style="max-width:600px"><h2 style="color:#1F2937;margin-bottom:20px">KYC</h2><div id="kyc-alert-page"></div><div class="alert alert-info"><strong>‚ÑπÔ∏è</strong> Verify identity</div><div class="kyc-step"><h3>Personal</h3><div class="form-group"><label>Full Name</label><input type="text" id="kyc-fullname" placeholder="As on ID"></div><div class="form-group"><label>DOB</label><input type="date" id="kyc-dob"></div><div class="form-group"><label>Address</label><textarea id="kyc-address" rows="3"></textarea></div></div><div class="kyc-step"><h3>ID</h3><div class="form-group"><label>Type</label><select id="kyc-idtype"><option value="">Select</option><option value="PASSPORT">Passport</option><option value="NATIONAL_ID">National ID</option><option value="DRIVERS_LICENSE">License</option></select></div><div class="form-group"><label>Number</label><input type="text" id="kyc-idnumber"></div></div><div class="kyc-step"><h3>BVN (Optional)</h3><div class="form-group"><label>BVN</label><input type="text" id="kyc-bvn" maxlength="11"></div></div><button class="btn btn-primary" onclick="submitKYC()" id="kyc-btn">Submit</button></div></div>

<div id="settings-page" class="hidden page"><header class="header"><div class="logo">üí∞ FlipCash</div><div class="nav-btns"><button class="btn btn-login" onclick="showPage('dashboard')">‚Üê Dashboard</button></div></header><div class="container" style="max-width:600px"><h2 style="color:#1F2937;margin-bottom:20px">Settings</h2><div id="settings-alert"></div><div class="kyc-step"><h3>Profile</h3><div class="form-group"><label>Email</label><input type="email" id="settings-email" disabled style="background:#F3F4F6"></div><div class="form-group"><label>Phone</label><input type="tel" id="settings-phone"></div><button class="btn btn-primary" onclick="updateProfile()">Update</button></div><div class="kyc-step"><h3>KYC Status</h3><div id="kyc-status-display"></div></div><div class="kyc-step"><h3>Details</h3><div id="personal-details-display"></div></div><div class="kyc-step"><h3>Security</h3><div class="form-group"><label>Current Password</label><input type="password" id="settings-current-password"></div><div class="form-group"><label>New Password</label><input type="password" id="settings-new-password"></div><div class="form-group"><label>Confirm</label><input type="password" id="settings-confirm-password"></div><button class="btn btn-primary" onclick="changePassword()">Change</button></div><div class="kyc-step"><h3>Notifications</h3><div class="checkbox-group"><input type="checkbox" id="settings-email-notif" checked><label style="margin:0">Email</label></div><div class="checkbox-group"><input type="checkbox" id="settings-sms-notif" checked><label style="margin:0">SMS</label></div><button class="btn btn-primary" onclick="saveNotifications()">Save</button></div></div></div>

<script>
const API_URL='https://flipcash-production.up.railway.app/api/v1';let userData=null,walletsData={NGN:0,KSH:0},exchangeRates={ngnToKsh:.18,kshToNgn:5.5},rateUpdateInterval,notifications=[];function showPage(e){clearAllAlerts(),document.querySelectorAll('[id$="-page"]').forEach(e=>e.classList.add("hidden")),document.getElementById(e+"-page").classList.remove("hidden"),window.scrollTo(0,0),closeNotifications(),"dashboard"===e&&loadDashboard(),"history"===e&&loadHistory(),"settings"===e&&loadSettings(),"deposit"===e&&loadDeposit(),"swap"===e&&(document.getElementById("swap-available").textContent=walletsData.NGN.toFixed(2),document.getElementById("swap-from-curr").textContent="NGN"),"withdraw"===e&&(document.getElementById("withdraw-available").textContent=walletsData.KSH.toFixed(2))}function clearAllAlerts(){["login-alert","register-alert","forgot-alert","swap-alert","withdraw-alert","kyc-alert-page","settings-alert"].forEach(e=>{const t=document.getElementById(e);t&&(t.innerHTML="")})}function showAlert(e,t,a,l=!0){const n=document.getElementById(e);if(!n||!t)return;const s="error"===a?"alert-error":"success"===a?"alert-success":"warning"===a?"alert-warning":"alert-info";n.innerHTML=`<div class="alert ${s}">${t}</div>`,l&&"success"===a&&setTimeout(()=>n.innerHTML="",3e3)}function showToast(e,t="info"){const a=document.createElement("div");a.className=`toast toast-${t}`;const l="success"===t?"‚úÖ":"error"===t?"‚ùå":"‚ÑπÔ∏è";a.innerHTML=`<span style="font-size:20px">${l}</span><span>${e}</span>`,document.body.appendChild(a),setTimeout(()=>{a.style.animation="slideUp 0.3s ease reverse",setTimeout(()=>a.remove(),300)},3e3)}function togglePassword(e,t){const a=document.getElementById(e);"password"===a.type?(a.type="text",t.textContent="üôà"):(a.type="password",t.textContent="üëÅÔ∏è")}function checkPasswordStrength(e){let t=0;e.length>=8&&t++,/[a-z]/.test(e)&&/[A-Z]/.test(e)&&t++,/\d/.test(e)&&t++,/[@$!%*?&]/.test(e)&&t++;const a=document.getElementById("password-strength-bar"),l=document.getElementById("password-strength-text");0===t?(a.style.width="0%",l.textContent=""):t<=2?(a.style.width="33%",a.style.background="#EF4444",l.textContent="Weak",l.style.color="#EF4444"):3===t?(a.style.width="66%",a.style.background="#F59E0B",l.textContent="Medium",l.style.color="#F59E0B"):(a.style.width="100%",a.style.background="#10B981",l.textContent="Strong",l.style.color="#10B981")}function toggleNotifications(){const e=document.getElementById("notif-panel"),t=document.getElementById("overlay");e.classList.contains("open")?closeNotifications():(e.classList.add("open"),t.classList.add("active"),loadNotifications())}function closeNotifications(){document.getElementById("notif-panel").classList.remove("open"),document.getElementById("overlay").classList.remove("active")}function loadNotifications(){const e=document.getElementById("notif-list");0===notifications.length?e.innerHTML='<div style="padding:40px;text-align:center;color:#6B7280"><div style="font-size:3rem">üîî</div><p>No notifications</p></div>':e.innerHTML=notifications.map(e=>`<div class="notif-item ${e.read?"":"unread"}" onclick="markAsRead('${e.id}')"><strong>${e.title}</strong><p style="color:#6B7280;margin-top:5px">${e.message}</p><small style="color:#9CA3AF">${e.time}</small></div>`).join("");const t=notifications.filter(e=>!e.read).length,a=document.getElementById("notif-badge");t>0?(a.textContent=t,a.style.display="flex"):a.style.display="none"}function addNotification(e,t){notifications.unshift({id:Date.now().toString(),title:e,message:t,time:(new Date).toLocaleTimeString(),read:!1}),loadNotifications()}function markAsRead(e){const t=notifications.find(t=>t.id===e);t&&(t.read=!0),loadNotifications()}async function handleLogin(){const e=document.getElementById("login-btn"),t=document.getElementById("login-email").value.trim(),a=document.getElementById("login-password").value,l=document.getElementById("remember-me").checked;if(!t||!a)return void showAlert("login-alert","Enter email and password","error");e.disabled=!0,e.textContent="Logging in...";try{const n=await fetch(`${API_URL}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:a})}),s=await n.json();"success"===s.status?(localStorage.setItem("accessToken",s.data.accessToken),l&&localStorage.setItem("rememberedEmail",t),localStorage.setItem("user",JSON.stringify(s.data.user)),userData=s.data.user,showToast("Login successful!","success"),setTimeout(()=>showPage("dashboard"),500)):(showAlert("login-alert",s.message||"Invalid credentials","error"),e.disabled=!1,e.textContent="Login")}catch(t){showAlert("login-alert","Connection error","error"),e.disabled=!1,e.textContent="Login"}}async function handleRegister(){const e=document.getElementById("register-btn"),t=document.getElementById("reg-firstname").value.trim(),a=document.getElementById("reg-lastname").value.trim(),l=document.getElementById("reg-email").value.trim(),n=document.getElementById("reg-country-code").value,s=document.getElementById("reg-phone").value.trim(),d=document.getElementById("reg-password").value,o=document.getElementById("reg-password-confirm").value;if(!t||!a||!l||!s||!d||!o)return void showAlert("register-alert","Fill all fields","error");const i="+254"===n?9:10;if(s.length!==i||!/^\d+$/.test(s))return void showAlert("register-alert",`Phone: ${i} digits after ${n}`,"error");if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(d))return void showAlert("register-alert","Password: min 8, 1 upper, 1 number, 1 special","error");if(d!==o)return void showAlert("register-alert","Passwords mismatch","error");const r=n+s;e.disabled=!0,e.textContent="Creating...";try{const n=await fetch(`${API_URL}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:t,lastName:a,email:l,phone:r,password:d})}),s=await n.json();"success"===s.status?(showAlert("register-alert","‚úÖ Account created! Redirecting...","success"),setTimeout(()=>showPage("login"),2e3)):(showAlert("register-alert",s.message||"Registration failed","error"),e.disabled=!1,e.textContent="Create Account")}catch(t){showAlert("register-alert","Connection error","error"),e.disabled=!1,e.textContent="Create Account"}}async function handleForgotPassword(){const e=document.getElementById("forgot-btn"),t=document.getElementById("forgot-email").value.trim();if(!t)return void showAlert("forgot-alert","Enter email","error");e.disabled=!0,e.textContent="Sending...";try{const a=await fetch(`${API_URL}/auth/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}),l=await a.json();"success"===l.status?(showAlert("forgot-alert","‚úÖ Reset link sent!","success"),setTimeout(()=>showPage("login"),3e3)):(showAlert("forgot-alert",l.message||"Failed","error"),e.disabled=!1,e.textContent="Send Reset Link")}catch(t){showAlert("forgot-alert","Connection error","error"),e.disabled=!1,e.textContent="Send Reset Link"}}function handleLogout(){confirm("Logout?")&&(rateUpdateInterval&&clearInterval(rateUpdateInterval),localStorage.clear(),sessionStorage.clear(),userData=null,walletsData={NGN:0,KSH:0},notifications=[];const e=document.querySelector(".btn-logout");e&&(e.textContent="Logout",e.disabled=!1),showPage("landing"),showToast("Logged out","success"))}async function loadDashboard(){try{const e=localStorage.getItem("accessToken"),t=JSON.parse(localStorage.getItem("user")||"{}");userData=t,document.getElementById("kyc-alert").style.display=t.kycVerified?"none":"block";try{const t=await fetch(`${API_URL}/wallets`,{headers:{Authorization:`Bearer ${e}`}}),a=await t.json();a.data&&Array.isArray(a.data)&&a.data.forEach(e=>{"NGN"===e.currency&&(document.getElementById("ngn-balance").textContent=e.balance.toFixed(2),walletsData.NGN=e.balance),"KSH"===e.currency&&(document.getElementById("ksh-balance").textContent=e.balance.toFixed(2),walletsData.KSH=e.balance)})}catch(e){console.error(e)}await loadLiveRates(),rateUpdateInterval&&clearInterval(rateUpdateInterval),rateUpdateInterval=setInterval(loadLiveRates,3e4)}catch(e){console.error(e)}}async function loadLiveRates(){try{const e=await fetch(`${API_URL}/rates`),t=await e.json();t.data&&(exchangeRates.ngnToKsh=t.data.ngnToKsh||.18,exchangeRates.kshToNgn=t.data.kshToNgn||5.5,document.getElementById("ngn-to-ksh-rate").textContent=exchangeRates.ngnToKsh.toFixed(4),document.getElementById("ksh-to-ngn-rate").textContent=exchangeRates.kshToNgn.toFixed(4))}catch(e){document.getElementById("ngn-to-ksh-rate").textContent="0.1800",document.getElementById("ksh-to-ngn-rate").textContent="5.5000"}}function loadDeposit(){const e=JSON.parse(localStorage.getItem("user")||"{}");e.firstName&&e.lastName&&(document.getElementById("account-name").textContent=`${e.firstName} ${e.lastName}`)}async function generateAccount(){const e=document.getElementById("gen-account-btn"),t=document.getElementById("gen-btn-text"),a=document.getElementById("gen-btn-loading");t.style.display="none",a.style.display="inline-block",e.disabled=!0;try{const l=localStorage.getItem("accessToken"),n=JSON.parse(localStorage.getItem("user")||"{}"),s=await fetch(`${API_URL}/rates/account/generate`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({currency:"NGN",email:n.email,firstName:n.firstName,lastName:n.lastName,phone:n.phone})}),d=await s.json();if("success"===d.status&&d.data&&d.data.accountNumber)document.getElementById("account-name").textContent=d.data.accountName||`${n.firstName} ${n.lastName}`,document.getElementById("account-number").textContent=d.data.accountNumber,t.textContent="‚úì Generated",t.style.display="inline",a.style.display="none",e.style.background="#059669",showToast("Account created!","success"),addNotification("Account Created","Virtual account ready");else throw new Error(d.message||"Failed")}catch(l){t.textContent="Try Again",t.style.display="inline",a.style.display="none",e.disabled=!1,showToast("Failed. Verify KYC","error")}}function calculateSwap(){const e=document.getElementById("swap-from").value,t=document.getElementById("swap-to").value,a=parseFloat(document.getElementById("swap-amount").value),l=walletsData[e]||0;if(document.getElementById("swap-available").textContent=l.toFixed(2),document.getElementById("swap-from-curr").textContent=e,!a||a<=0)return void(document.getElementById("swap-summary").style.display="none");if(a>l)return showAlert("swap-alert",`‚ö†Ô∏è Insufficient ${e}. Have ${l.toFixed(2)}`,"error",!1),void(document.getElementById("swap-summary").style.display="none");const n="NGN"===e?exchangeRates.ngnToKsh:exchangeRates.kshToNgn,s=a*n-a*n*.01;document.getElementById("summary-send-amount").textContent=`${a.toFixed(2)} ${e}`,document.getElementById("summary-rate").textContent=`1 ${e} = ${n.toFixed(4)} ${t}`,document.getElementById("summary-fee").textContent=`${(a*.01).toFixed(2)} ${e}`,document.getElementById("summary-receive-amount").textContent=`${s.toFixed(2)} ${t}`,document.getElementById("swap-summary").style.display="block",clearAllAlerts()}async function handleSwap(){const e=document.getElementById("swap-btn"),t=document.getElementById("swap-from").value,a=document.getElementById("swap-to").value,l=parseFloat(document.getElementById("swap-amount").value);if(!l||l<=0)return void showAlert("swap-alert","Enter amount","error");if(l>(walletsData[t]||0))return void showAlert("swap-alert","‚ö†Ô∏è Insufficient","error");e.disabled=!0,e.textContent="Processing...";try{const n=localStorage.getItem("accessToken"),s=await fetch(`${API_URL}/transactions/swap`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({fromCurrency:t,toCurrency:a,amount:l})}),d=await s.json();"success"===d.status?(showToast("Swap successful!","success"),addNotification("Swap Done",`${l} ${t} ‚Üí ${a}`),setTimeout(()=>showPage("dashboard"),1500)):(showAlert("swap-alert",d.message||"Failed","error"),e.disabled=!1,e.textContent="Confirm")}catch(t){showAlert("swap-alert","Connection error","error"),e.disabled=!1,e.textContent="Confirm"}}function calculateWithdraw(){const e=parseFloat(document.getElementById("withdraw-amount").value),t=walletsData.KSH||0;if(document.getElementById("withdraw-available").textContent=t.toFixed(2),!e||e<=0)return void(document.getElementById("withdraw-summary").style.display="none");const a=e+.02*e;return a>t?(showAlert("withdraw-alert",`‚ö†Ô∏è Need ${a.toFixed(2)} KSH (incl fee). Have ${t.toFixed(2)}`,"error",!1),void(document.getElementById("withdraw-summary").style.display="none")):(document.getElementById("w-summary-amount").textContent=`${e.toFixed(2)} KSH`,document.getElementById("w-summary-fee").textContent=`${(.02*e).toFixed(2)} KSH`,document.getElementById("w-summary-total").textContent=`${a.toFixed(2)} KSH`,document.getElementById("w-summary-receive").textContent=`${e.toFixed(2)} KSH`,document.getElementById("withdraw-summary").style.display="block",void clearAllAlerts())}function verifyMpesaNumber(){const e=document.getElementById("withdraw-phone").value.trim(),t=document.getElementById("mpesa-name-display");if(!e.startsWith("+254"))return t.style.display="none",void showAlert("withdraw-alert","Must start +254","error",!1);const a=e.substring(4);return 9!==a.length||!/^\d{9}$/.test(a)?(t.style.display="none",void showAlert("withdraw-alert","9 digits after +254","error",!1)):["7","1"].includes(a[0])?(clearAllAlerts(),t.innerHTML='<div class="mpesa-name"><strong>‚úÖ Valid</strong><p style="color:#059669;margin-top:5px">Verified on withdrawal</p></div>',void(t.style.display="block")):(t.style.display="none",void showAlert("withdraw-alert","Invalid format","error",!1))}async function handleWithdraw(){const e=document.getElementById("withdraw-btn"),t=parseFloat(document.getElementById("withdraw-amount").value),a=document.getElementById("withdraw-phone").value.trim(),l=document.getElementById("withdraw-method").value;if(!t||!a)return void showAlert("withdraw-alert","Fill all fields","error");if(!a.startsWith("+254")||9!==a.substring(4).length)return void showAlert("withdraw-alert","Invalid phone","error");if(t+.02*t>(walletsData.KSH||0))return void showAlert("withdraw-alert","‚ö†Ô∏è Insufficient","error");e.disabled=!0,e.textContent="Processing...";try{const n=localStorage.getItem("accessToken"),s=await fetch(`${API_URL}/transactions/withdraw`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({currency:"KSH",amount:t,phone:a,method:l})}),d=await s.json();"success"===d.status?(showToast(`${t} KSH initiated!`,"success"),addNotification("Withdrawal",`${t} KSH to ${a}`),setTimeout(()=>showPage("dashboard"),1500)):(showAlert("withdraw-alert",d.message||"Failed","error"),e.disabled=!1,e.textContent="Withdraw")}catch(t){showAlert("withdraw-alert","Connection error","error"),e.disabled=!1,e.textContent="Withdraw"}}async function loadHistory(){try{const e=localStorage.getItem("accessToken"),t=await fetch(`${API_URL}/transactions?limit=50`,{headers:{Authorization:`Bearer ${e}`}}),a=await t.json(),l=document.getElementById("transaction-list");a.data&&a.data.length>0?l.innerHTML=a.data.map(e=>`<div style="padding:15px;border-bottom:1px solid #E5E7EB;display:flex;justify-content:space-between"><div><strong style="color:#10B981">${e.type.toUpperCase()}</strong><br><small style="color:#6B7280">${new Date(e.createdAt).toLocaleDateString()}</small></div><div style="text-align:right"><strong>${e.amount} ${e.currency}</strong><br><small style="color:${"completed"===e.status?"#10B981":"#EAB308"}">${e.status.toUpperCase()}</small></div></div>`).join(""):l.innerHTML='<div style="text-align:center;padding:60px 20px;color:#6B7280"><div style="font-size:3rem">üìä</div><p style="font-size:1.2rem;font-weight:600">No transactions</p><button class="btn btn-primary" onclick="showPage(\'deposit\')" style="max-width:200px;margin:20px auto">Deposit</button></div>'}catch(e){console.error(e)}}async function submitKYC(){const e=document.getElementById("kyc-btn"),t=document.getElementById("kyc-fullname").value.trim(),a=document.getElementById("kyc-dob").value,l=document.getElementById("kyc-address").value.trim(),n=document.getElementById("kyc-idtype").value,s=document.getElementById("kyc-idnumber").value.trim(),d=document.getElementById("kyc-bvn").value.trim();if(!t||!a||!l||!n||!s)return void showAlert("kyc-alert-page","Fill required fields","error");if((new Date).getFullYear()-(new Date(a)).getFullYear()<18)return void showAlert("kyc-alert-page","Must be 18+","error");e.disabled=!0,e.textContent="Submitting...";try{const o=localStorage.getItem("accessToken"),i=await fetch(`${API_URL}/users/kyc`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({fullname:t,dob:a,address:l,idType:n,idNumber:s,bvn:d||void 0})}),r=await i.json();if("success"===r.status){showToast("KYC submitted!","success"),addNotification("KYC Submitted","Review in 24hrs");const e=JSON.parse(localStorage.getItem("user")||"{}");e.kycStatus="pending",localStorage.setItem("user",JSON.stringify(e)),setTimeout(()=>showPage("dashboard"),1500)}else showAlert("kyc-alert-page",r.message||"Failed","error"),e.disabled=!1,e.textContent="Submit"}catch(t){showAlert("kyc-alert-page","Connection error","error"),e.disabled=!1,e.textContent="Submit"}}function loadSettings(){const e=JSON.parse(localStorage.getItem("user")||"{}");document.getElementById("settings-email").value=e.email||"",document.getElementById("settings-phone").value=e.phone||"";const t=document.getElementById("kyc-status-display"),a=e.kycStatus||"not_submitted";"approved"===a?t.innerHTML='<div class="kyc-status approved">‚úÖ Approved</div><p style="color:#6B7280;margin-top:10px">Verified</p>':"pending"===a?t.innerHTML='<div class="kyc-status pending">‚è≥ Pending</div><p style="color:#6B7280;margin-top:10px">Review 24hrs</p>':"rejected"===a?t.innerHTML='<div class="kyc-status rejected">‚ùå Rejected</div><button class="btn btn-primary" onclick="showPage(\'kyc\')" style="max-width:200px;margin-top:15px">Resubmit</button>':t.innerHTML='<p style="color:#6B7280">Not submitted</p><button class="btn btn-primary" onclick="showPage(\'kyc\')" style="max-width:200px;margin-top:15px">Submit</button>';const l=document.getElementById("personal-details-display");e.fullname?l.innerHTML=`<p style="margin:10px 0"><strong>Name:</strong> ${e.fullname}</p><p style="margin:10px 0"><strong>DOB:</strong> <span class="blur-text">${e.dob||"N/A"}</span></p><p style="margin:10px 0"><strong>Address:</strong> ${e.address?e.address.substring(0,20)+"...":"N/A"} <span class="blur-text">${e.address?e.address.substring(20):""}</span></p><p style="margin:10px 0"><strong>ID:</strong> ${e.idType||"N/A"}</p><p style="margin:10px 0"><strong>ID#:</strong> <span class="blur-text">${e.idNumber||"N/A"}</span></p>${e.bvn?`<p style="margin:10px 0"><strong>BVN:</strong> <span class="blur-text">${e.bvn}</span></p>`:""}`:l.innerHTML='<p style="color:#6B7280">No details. Complete KYC.</p>'}async function updateProfile(){const e=document.getElementById("settings-phone").value.trim();if(!e)return void showAlert("settings-alert","Enter phone","error");try{const t=localStorage.getItem("accessToken"),a=await fetch(`${API_URL}/users/me`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({phone:e})}),l=await a.json();"success"===l.status?(showToast("Updated!","success"),localStorage.setItem("user",JSON.stringify(l.data)),userData=l.data):showAlert("settings-alert",l.message||"Failed","error")}catch(e){showAlert("settings-alert","Error","error")}}function changePassword(){const e=document.getElementById("settings-current-password").value,t=document.getElementById("settings-new-password").value,a=document.getElementById("settings-confirm-password").value;return e&&t&&a?t.length<6?void showAlert("settings-alert","Min 6 chars","error"):t!==a?void showAlert("settings-alert","Mismatch","error"):void showToast("Contact support@flipcash.app","info"):void showAlert("settings-alert","Fill all fields","error")}function saveNotifications(){const e=document.getElementById("settings-email-notif").checked,t=document.getElementById("settings-sms-notif").checked;localStorage.setItem("notificationPrefs",JSON.stringify({email:e,sms:t})),showToast("Saved!","success")}localStorage.getItem("accessToken")&&showPage("dashboard");let lastTouchEnd=0;document.addEventListener("touchend",function(e){Date.now()-lastTouchEnd<=300&&e.preventDefault(),lastTouchEnd=Date.now()},!1);
</script>
</body>
</html>
